{# Load the tag library #}
{% load bootstrap4 %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}

<!-- A grey horizontal navbar that becomes vertical on small screens -->
<nav class="navbar navbar-expand-sm bg-light">

  <!-- Links -->
  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="nav-link" href="/">Доступные поездки</a>
    </li>
    {% if auth %}
    <li class="nav-item">
      <a class="nav-link" href="/logout">Выйти</a>
    </li>
    {% else %}
    <li class="nav-item">
      <a class="nav-link" href="/login/vk-oauth2">Войти</a>
    </li>
    {% endif %}
  </ul>

</nav>



{% if auth %}
<h1> {{ auth }} </h1>
{% endif %}



{% if auth %}
<form action="/" method="post">
    {% csrf_token %}
    <div class="input-group mb-3">
    <input type="text" name="target" placeholder="target" class="form-control"/>
    <input type="datetime-local" name="date" class="form-control"/>
    <input type="number" name="free_places" placeholder="number of people" class="form-control"/>
    <button type="submit" class="btn btn-primary">Add a trip</button>
    </div>
</form>
{% endif %}

<div class="row">
  <div class="col-sm-4">{% if trips %}
    <table class="table" title="title">
    <thead>
    <tr>
      <th scope="col">вс. 21.04</th>
      <th scope="col">Участники</th>
      <th scope="col"></th>
      <th scope="col"></th>
    </tr>
    </thead>
    {% for trip in trips %}
        <tr>
            <td>
            <div>{{trip.trip_info.target}}</div>
            <small>{{trip.trip_info.free_places}}
            {% if trip.trip_info.free_places == 1 %}
            место
            {% elif trip.trip_info.free_places <= 4 and trip.trip_info.free_places >= 2%}
            места
            {% else %}
            мест
            {% endif %}
            </small>
            </td>
            <td>{% for user in trip.users %}
                {{ user }},
            {% endfor %}</td>
            <td>
            {% if auth %}
                <form action="/" method="post">
                    {% csrf_token %}
                    {% if trip.joining %}
                    <div class="input-group mb-3">
                    <button type="submit" class="btn btn-warning" name="leave{{trip.trip_info.id}}">Отказаться</button>
                    </div>
                    {% elif trip.trip_info.free_places > 0 %}
                    <div class="input-group mb-3">
                    <button type="submit" class="btn btn-primary" name="join{{trip.trip_info.id}}">Присоединиться</button>
                    </div>
                    {% endif %}
                </form>
            {% endif %}
            </td>
        </tr>
    {% endfor %}
    </table>
    
{% else %}
    <p>No trips are available.</p>
{% endif %}</div>
  <div class="col-sm-4">.col-sm-4</div>
  <div class="col-sm-4">.col-sm-4</div>
</div>

